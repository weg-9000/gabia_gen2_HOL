# 제목 없음

각 Lab 문서를 확인하여 점검하겠습니다.이제 shop-app 레포지토리를 확인하겠습니다.이제 전체 Lab 문서들과 shop-app을 비교 분석하겠습니다.

---

## Lab 문서 점검 결과

### 전체 흐름도

```
Lab 01 (서버 생성) → Lab 02 (오토스케일링) → Lab 03 (블록 스토리지) → Lab 04 (NAS)
         ↓                    ↓                      ↓                    ↓
  shop-app 연동X      shop-app 연동X        PostgreSQL 설치        파일 공유

```

---

## 문제점 분석

### 1. shop-app 연동 현황

| Lab | shop-app 연동 | 현재 상태 | 문제 |
| --- | --- | --- | --- |
| Lab 01 | X | Nginx 샘플 페이지만 | shop-app 배포 없음 |
| Lab 02 | X | Nginx 설치만 | shop-app 없음, AS 서버에 수동 설치 |
| Lab 03 | △ | PostgreSQL 설치 | shop-app DB 연결 방법 없음 |
| Lab 04 | X | 파일 공유만 | shop-app 이미지 저장 연동 없음 |

### 2. 각 Lab 상세 문제점

### Lab 01 문제점

| 항목 | 현재 | 문제 |
| --- | --- | --- |
| Lab 01-A | 기본 서버 생성 | 적절 |
| Lab 01-B | Nginx 설치 스크립트 | **shop-app 배포 스크립트 필요** |
| 서버 이름 | lab-server, web-server | **shop-server로 통일 필요** |

### Lab 02 문제점

| 항목 | 현재 | 문제 |
| --- | --- | --- |
| 웹 서버 | 수동 Nginx 설치 | **사용자 스크립트로 자동화 필요** |
| 애플리케이션 | 없음 | **shop-app 배포 필요** |
| LB 테스트 | 호스트명만 | **shop-app /health 엔드포인트 활용** |

### Lab 03 문제점

| 항목 | 현재 | 문제 |
| --- | --- | --- |
| PostgreSQL | 설치만 | shop-app 연결 설정 없음 |
| Database | shopdb 생성 | **shop-app 스키마 초기화 필요** |
| 연결 | 로컬만 | **shop-app 환경변수 설정 없음** |

### Lab 04 문제점

| 항목 | 현재 | 문제 |
| --- | --- | --- |
| NAS 용도 | 일반 파일 공유 | shop-app 이미지 저장 연동 없음 |
| 서브넷 | shop-app-subnet | Lab 01-03과 불일치 가능 |

---

## 수정 권장 사항

### 1. Lab 01 수정

**Lab 01-B 사용자 스크립트에 shop-app 배포 추가:**

```bash
#!/bin/bash

# 시스템 업데이트
apt-get update -y
apt-get upgrade -y

# Python 및 필수 패키지 설치
apt-get install -y python3 python3-pip python3-venv git nginx

# shop-app 다운로드
cd /opt
git clone <https://github.com/weg-9000/gabia_gen2_HOL.git>
cd gabia_gen2_HOL/shop-app

# 가상환경 생성 및 의존성 설치
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt

# 환경 변수 설정
cat > .env << 'EOF'
ENVIRONMENT=development
DATABASE_URL=sqlite:///./shop.db
HOST=0.0.0.0
PORT=8000
EOF

# Systemd 서비스 등록
cat > /etc/systemd/system/shop-app.service << 'EOF'
[Unit]
Description=Shop App
After=network.target

[Service]
User=root
WorkingDirectory=/opt/gabia_gen2_HOL/shop-app
ExecStart=/opt/gabia_gen2_HOL/shop-app/venv/bin/uvicorn app.main:app --host 0.0.0.0 --port 8000
Restart=always

[Install]
WantedBy=multi-user.target
EOF

systemctl daemon-reload
systemctl enable shop-app
systemctl start shop-app

# Nginx 리버스 프록시 설정
cat > /etc/nginx/sites-available/shop-app << 'EOF'
server {
    listen 80;
    server_name _;

    location / {
        proxy_pass <http://127.0.0.1:8000>;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    location /health {
        proxy_pass <http://127.0.0.1:8000/health>;
    }
}
EOF

ln -sf /etc/nginx/sites-available/shop-app /etc/nginx/sites-enabled/
rm -f /etc/nginx/sites-enabled/default
nginx -t && systemctl restart nginx

```

### 2. Lab 02 수정

**오토스케일링 사용자 스크립트 추가:**

- Lab 01-B의 shop-app 스크립트를 사용자 스크립트로 등록
- 또는 새로운 스크립트 생성

**LB 테스트 수정:**

```bash
# 기존: 호스트명 확인
curl http://[LB IP]

# 수정: shop-app 헬스체크
curl http://[LB IP]/health
curl http://[LB IP]/stats
curl http://[LB IP]/api/v1/products

```

### 3. Lab 03 수정

**PostgreSQL + shop-app 연동 추가:**

```bash
# 데이터베이스 생성
sudo -u postgres psql << 'EOF'
CREATE DATABASE shopdb;
CREATE USER shopuser WITH PASSWORD 'shoppass';
GRANT ALL PRIVILEGES ON DATABASE shopdb TO shopuser;
\\c shopdb
GRANT ALL ON SCHEMA public TO shopuser;
EOF

# 스키마 초기화 (shop-app에서)
cd /opt/gabia_gen2_HOL/shop-app
psql -U shopuser -d shopdb -f docker/init-db.sql

# shop-app 환경변수 수정
cat > .env << 'EOF'
ENVIRONMENT=production
DATABASE_URL=postgresql://shopuser:shoppass@localhost:5432/shopdb
HOST=0.0.0.0
PORT=8000
EOF

# 서비스 재시작
systemctl restart shop-app

```

### 4. Lab 04 수정

**NAS + shop-app 이미지 저장 연동:**

```bash
# NAS 마운트
sudo mount -t nfs4 10.0.x.x:/share-xxxxx /mnt/nas

# shop-app 이미지 디렉토리 심볼릭 링크
mkdir -p /mnt/nas/shop-images
ln -sf /mnt/nas/shop-images /opt/gabia_gen2_HOL/shop-app/static/images

```

---

## 서버 네이밍 통일

### 현재 (불일치)

| Lab | 서버 이름 |
| --- | --- |
| Lab 01-A | lab-server |
| Lab 01-B | web-server |
| Lab 02 | AS-Server-xxx |
| Lab 03 | shop-server (참조) |
| Lab 04 | shop-app-subnet |

### 권장 (통일)

| Lab | 서버 이름 | 용도 |
| --- | --- | --- |
| Lab 01 | shop-server | 단일 서버 |
| Lab 02 | AS-shop-xxx | 오토스케일링 |
| Lab 03 | shop-server | DB 서버 (동일) |
| Lab 04 | shop-server | NAS 연결 (동일) |

---

## 수정 우선순위

| 순위 | Lab | 수정 내용 | 긴급도 |
| --- | --- | --- | --- |
| 1 | Lab 01-B | shop-app 배포 스크립트 추가 | 높음 |
| 2 | Lab 03 | shop-app DB 연동 추가 | 높음 |
| 3 | Lab 02 | 사용자 스크립트 연동, LB 테스트 수정 | 중간 |
| 4 | Lab 04 | shop-app 이미지 저장 연동 | 낮음 |
| 5 | 전체 | 서버 네이밍 통일 | 낮음 |

---

## 결론

**현재 Lab 01~04는 shop-app 배포와 연동되어 있지 않습니다.**

수정이 필요한 항목:

1. **Lab 01-B**: shop-app 배포 사용자 스크립트 추가
2. **Lab 03**: PostgreSQL + shop-app 연동 섹션 추가
3. **Lab 02**: shop-app 사전 배포 또는 사용자 스크립트 연동
4. **Lab 04**: shop-app 이미지 저장 용도로 NAS 활용

수정을 진행하시겠습니까?