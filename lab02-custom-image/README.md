# Lab 02: 커스텀 이미지 생성

## 🎯 학습 목표
- 설정된 서버를 이미지로 캡처하는 방법 학습
- 이미지 기반 빠른 배포 전략 이해
- 인프라 코드화(Infrastructure as Code)의 기초 학습

## 🤔 왜 이 Lab이 필요한가?

### 문제: 서버 설정의 반복 작업
```
새 서버 생성할 때마다:
1. OS 업데이트 (10분)
2. Python 설치 (5분)
3. 패키지 설치 (10분)
4. 애플리케이션 배포 (15분)
5. 설정 파일 복사 (5분)
───────────────────────
총: 45분 소요 
```

### 해결: 커스텀 이미지 사용
```
이미지 생성 (1회): 10분
새 서버 생성 (이미지 사용): 2분 

10개 서버 생성 시:
- 기존 방식: 450분 (7.5시간)
- 이미지 방식: 30분
→ 420분 절약!
```

## 📖 배경 지식

### 이미지(Image)란?
```
서버의 전체 상태를 저장한 템플릿

포함 내용:
운영체제
설치된 소프트웨어
설정 파일
데이터 (선택적)

제외 내용:
IP 주소
호스트명
SSH 키 (보안상)
```

### 스냅샷 vs 이미지

| 구분 | 스냅샷 | 이미지 |
|------|--------|--------|
| 목적 | 백업/복원 | 복제/배포 |
| 속도 | 빠름 | 느림 |
| 범위 | 특정 서버 | 여러 서버 |
| 네트워크 | 유지 | 새로 할당 |

## 🚀 실습 단계

### 1단계: 서버 준비
```bash
# Lab 01 서버 사용
# FastAPI 앱이 설치된 상태여야 함

# 확인
curl http://localhost:8000/health
```

### 2단계: 이미지 생성 전 정리
```bash
# 임시 파일 정리
sudo rm -rf /tmp/*
sudo rm -rf /var/tmp/*

# 로그 정리
sudo truncate -s 0 /var/log/*.log

# 패키지 캐시 정리
sudo apt clean
sudo apt autoclean

# Bash history 정리
cat /dev/null > ~/.bash_history
history -c
```

**왜 정리하는가?**
- 이미지 크기 최소화
- 민감 정보 제거
- 깨끗한 시작 상태

### 3단계: 가비아 콘솔에서 이미지 생성
```
서버 목록 → 서버 선택 → 이미지 생성
이름: gabia-shop-v1.0
설명: FastAPI + PostgreSQL 사전 설치
```

생성 시간: 약 10-15분

### 4단계: 이미지로 새 서버 생성
```
서버 생성 → 이미지 선택 → gabia-shop-v1.0
```

### 5단계: 검증
```bash
# 새 서버에서
uvicorn app.main:app --host 0.0.0.0 --port 8000
curl http://localhost:8000/health
```

## 💡 Best Practices
1. 버전 관리 (v1.0, v1.1, ...)
2. 설명 명확히 기록
3. 정기적으로 업데이트
4. 테스트 후 공유
