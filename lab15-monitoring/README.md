정책 문서 검색을 완료했습니다. 이제 검색된 정책 정보를 기반으로 Lab 문서를 작성하겠습니다.

---

# Lab 15: 모니터링 알람

## 학습 목표

- 가비아 Gen2 모니터링 알람 서비스 이해
- 서버 시스템/트래픽 알람 생성 및 설정
- 이벤트 로그 기반 알람 구성
- 알람 수신자 및 발송 정책 설정

**소요 시간**: 25분
**난이도**: 초급
**선행 조건**: Lab 01 완료 (shop-server 운영 중)

---

## 가비아 Gen2 모니터링 알람 정책

### 기본 정책

| 항목 | 정책 |
|------|------|
| 알람 구분 | 프로젝트 알람, 그룹 알람 |
| 모니터링 자원 구분 | 서버, 로드밸런서, WAF(웹방화벽) |
| 알람당 대상 자원 | 최대 10개 |
| 알람당 조건 | 최대 20개 |
| 알람 상태 | 운영, 정지 |

### 알람 발송 정책

| 항목 | 정책 |
|------|------|
| 발송 방법 | 메시지(알림톡/SMS), E-Mail |
| 메시지 수신 횟수 | 1회 ~ 20회/일 (사용자 지정) |
| 이메일 발송 | 횟수 제한 없음 |
| 메시지 수신 횟수 초기화 | 매일 00:00 |
| 발송 비용 | 무료 |

### 자원별 알람 항목

| 자원 구분 | 알람 항목 | 임계치 범위 | 체크 주기 |
|-----------|-----------|-------------|-----------|
| 서버 | CPU 사용률 (%) | 1% ~ 100% | 1분 |
| 서버 | 메모리 사용률 (%) | 1% ~ 100% | 1분 |
| 서버 | 디스크(root) 사용률 (%) | 1% ~ 100% | 1분 |
| 서버 | 디스크(data) 사용률 (%) | 1% ~ 100% | 1분 |
| 서버 | 트래픽 사용량 (GB) | 1GB ~ 1,000,000GB | 30분 |
| 로드밸런서 | 트래픽 사용량 (GB) | 1GB ~ 1,000,000GB | 30분 |
| NAS | 용량 사용률 | 임계치 이상 시 즉시 | - |

### 수신 대상 정책

| 항목 | 정책 |
|------|------|
| 수신 대상 | 프로젝트 멤버 중 이메일/메시지 수신 허용한 멤버 |
| 필수 여부 | 수신자 0명 가능 (필수값 아님) |
| 제약사항 | 알람 수신자로 지정된 멤버는 프로젝트에서 제외 불가 |

> 📄 **출처:** `모니터링 알람 정책.pdf`

---

## 실습 단계

### 1. 모니터링 알람 메뉴 접근

```
콘솔 > 모니터링 > 모니터링 알람
```

알람 목록 페이지에서 현재 설정된 알람을 확인할 수 있다.

### 2. 시스템/트래픽 알람 생성

#### 2-1. 알람 생성 시작

```
콘솔 > 모니터링 > 모니터링 알람 > 알람 생성
```

#### 2-2. 모니터링 자원 구분 선택

```
자원 구분: 서버
```

선택 가능 옵션:
- 서버
- 로드밸런서
- WAF(웹방화벽)

#### 2-3. 대상 자원 선택

```
대상 자원: shop-server (체크)
```

조건:
- 해당 프로젝트에 존재하는 자원만 노출
- 최대 10개까지 선택 가능

#### 2-4. 알람 조건 설정

**CPU 사용률 알람:**

| 항목 | 설정값 |
|------|--------|
| 알람 항목 | CPU 사용률 (%) |
| 임계치 | 80 |
| 수신 방법 | 메시지, E-Mail (둘 다 체크) |
| 수신 시간 | 00:00 ~ 23:59 (종일) |
| 메시지 수신 횟수 | 5회 |

**메모리 사용률 알람 추가:**

| 항목 | 설정값 |
|------|--------|
| 알람 항목 | 메모리 사용률 (%) |
| 임계치 | 85 |
| 수신 방법 | 메시지, E-Mail |
| 수신 시간 | 00:00 ~ 23:59 |
| 메시지 수신 횟수 | 5회 |

**디스크 사용률 알람 추가:**

| 항목 | 설정값 |
|------|--------|
| 알람 항목 | 디스크(root) 사용률 (%) |
| 임계치 | 90 |
| 수신 방법 | E-Mail |
| 수신 시간 | 00:00 ~ 23:59 |

조건 설정 참고:
- 알람 조건은 중복 불가
- 하나의 알람에 최대 20개 조건 설정 가능
- 수신 방법 1개 이상 필수 선택
- 수신 시간은 1시간 단위 지정 가능

#### 2-5. 알람 수신 대상 설정

```
수신 대상: 프로젝트 멤버 선택 (체크)
```

참고:
- 프로젝트에 등록된 멤버 중 이메일/메시지 수신 허용한 멤버만 노출
- 수신 대상은 필수값 아님 (0명 가능)

#### 2-6. 이름 및 설명 입력

| 항목 | 입력값 |
|------|--------|
| 알람 이름 | shop-server-system-alert |
| 설명 | shop-server CPU/메모리/디스크 모니터링 |

#### 2-7. 알람 생성 완료

```
[알람 생성] 클릭
```

### 3. 트래픽 사용량 알람 생성

#### 3-1. 신규 알람 생성

```
콘솔 > 모니터링 > 모니터링 알람 > 알람 생성
```

#### 3-2. 설정 정보

| 항목 | 설정값 |
|------|--------|
| 자원 구분 | 서버 |
| 대상 자원 | shop-server |
| 알람 항목 | 국내 트래픽 사용량 (아웃바운드) |
| 임계치 | 100 GB |
| 수신 방법 | 메시지, E-Mail |
| 수신 시간 | 00:00 ~ 23:59 |
| 메시지 수신 횟수 | 3회 |
| 알람 이름 | shop-server-traffic-alert |
| 설명 | shop-server 트래픽 모니터링 |

참고:
- 트래픽 사용량은 30일 이내 누적치를 30분 단위로 체크
- 시스템에서 매시 15분, 45분에 누적치를 체크하여 0분, 30분에 알람 발송

### 4. 이벤트 로그 알람 생성

이벤트 로그 기반 알람으로 서버 상태 변경 시 알림을 받을 수 있다.

#### 4-1. 알람 생성

```
콘솔 > 모니터링 > 모니터링 알람 > 알람 생성
```

#### 4-2. 이벤트 로그 알람 설정

| 항목 | 설정값 |
|------|--------|
| 알람 유형 | 이벤트 로그 |
| 이벤트 선택 | 서버 정지, 서버 재시작, 서버 삭제 |
| 대상 자원 선택 | shop-server (선택적) |
| 수신 방법 | 메시지, E-Mail |
| 알람 이름 | shop-server-event-alert |
| 설명 | shop-server 상태 변경 알림 |

참고:
- 이벤트 로그 알람은 OR 조건으로 발송 (설정된 이벤트 중 하나라도 발생 시)
- 대상 자원 선택 시, 해당 자원 이름이 포함된 이벤트만 알람 발송
- 접두사 추가 가능 (최대 20자)

### 5. 알람 상태 관리

#### 5-1. 알람 목록 확인

```
콘솔 > 모니터링 > 모니터링 알람
```

생성된 알람 목록:
- shop-server-system-alert (운영)
- shop-server-traffic-alert (운영)
- shop-server-event-alert (운영)

#### 5-2. 알람 정지/운영 전환

```
콘솔 > 모니터링 > 모니터링 알람 > [알람 선택] > 비활성화/활성화
```

알람 상태:
- **운영**: 조건 충족 시 알람 발송
- **정지**: 알람 미발송, 설정만 저장된 상태

참고:
- 알람에 설정된 자원이 모두 삭제된 경우, 해당 알람은 자동으로 '정지'됨
- 자원 추가 후 다시 활성화 가능

### 6. 알람 조건 수정

#### 6-1. 알람 상세 페이지 접근

```
콘솔 > 모니터링 > 모니터링 알람 > shop-server-system-alert 클릭
```

#### 6-2. 알람 조건 변경

```
알람 조건 테이블 > CPU 사용률 행 > 관리 > 수정
```

| 항목 | 변경 전 | 변경 후 |
|------|---------|---------|
| 임계치 | 80% | 70% |

```
[저장] 클릭
```

#### 6-3. 알람 조건 추가

```
알람 조건 테이블 > [알람 항목 추가] 클릭
```

| 항목 | 설정값 |
|------|--------|
| 알람 항목 | 디스크(data) 사용률 (%) |
| 임계치 | 85 |
| 수신 방법 | E-Mail |

```
[저장] 클릭
```

참고:
- 알람 대상 자원과 알람 조건은 각각 수정 가능
- 모니터링 자원 구분은 변경 불가
- 알람 조건을 모두 삭제할 수 없음 (최소 1개 필수)

### 7. 알람 수신자 변경

```
콘솔 > 모니터링 > 모니터링 알람 > shop-server-system-alert > 수신자 관리
```

수신자 추가/제거 후 저장

참고:
- 알람 수신자로 지정된 프로젝트 멤버는 프로젝트에서 제외 불가

### 8. 알람 내역 확인

```
콘솔 > 모니터링 > 알람 내역
```

발송된 알람 이력을 확인할 수 있다.

### 9. 알람 삭제

```
콘솔 > 모니터링 > 모니터링 알람 > [알람 선택] > 삭제
```

---

## 알람 테스트 (선택)

### CPU 부하 발생으로 알람 테스트

```bash
# SSH 접속
ssh -i lab-keypair.pem ubuntu@[서버IP]

# CPU 부하 발생 (stress 설치)
sudo apt install -y stress

# CPU 100% 부하 (2분간)
stress --cpu 2 --timeout 120
```

설정한 임계치(70%)를 초과하면 1분 내 알람이 발송된다.

### 알람 수신 확인

- 알림톡/SMS: 등록된 휴대전화번호로 수신
- E-Mail: 등록된 이메일 주소로 수신

---

## 트러블슈팅

| 문제 | 원인 | 해결 |
|------|------|------|
| 알람 미발송 | 알람 정지 상태 | 알람 활성화 |
| 알람 미발송 | 수신 시간 외 | 수신 시간 설정 확인 |
| 알람 미발송 | 수신자 미설정 | 수신자 추가 |
| 메시지 미수신 | 일일 수신 횟수 초과 | 다음 날 00:00 초기화 대기 또는 이메일 확인 |
| 자원 선택 불가 | 프로젝트 내 자원 없음 | 해당 자원 생성 필요 |
| 알람 자동 정지 | 대상 자원 모두 삭제됨 | 대상 자원 추가 후 활성화 |
| 알람 조건 삭제 불가 | 최소 1개 조건 필수 | 조건 수정으로 대체 |
| 이벤트 알람 미발송 | 접두사 불일치 | 대상 자원 이름 확인 |

---

## 완료 체크리스트

```
[ ] 시스템 알람 생성 (CPU/메모리/디스크)
[ ] 트래픽 알람 생성
[ ] 이벤트 로그 알람 생성
[ ] 알람 조건 설정 (임계치, 수신 방법, 수신 시간)
[ ] 알람 수신자 설정
[ ] 알람 상태 관리 (운영/정지)
[ ] 알람 조건 수정
[ ] 알람 내역 확인
[ ] (선택) CPU 부하 테스트로 알람 수신 확인
```

---

**다음 Lab**: [Lab 16: Auto Backup](../lab16-auto-backup/README.md)
